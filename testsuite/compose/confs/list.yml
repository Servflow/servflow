id: list
http:
  listenPath: /notes/
  method: GET
  next: action.authenticate
conditionals:
actions:
  authenticate:
    type: authenticate
    config:
      integrationID: mongo
      databaseField: email
      failOnAuthError: true
      jwtKey: "test"
      token: '{{ header "Authorization" }}'
      collection: "users"
    next: action.fetchItem
    fail: response.invalidAuth
  fetchItem:
    type: fetch
    config:
      integrationID: mongo
      table: notes
      failIfEmpty: true
      filters:
        - field: owner
          operation: "=="
          comparator: "{{ .variable_actions_authenticate }}"
    next: response.success
    fail: response.404
responses:
  "400":
    type: template
    template: |
      {"errors": {{ .error }}}
    code: 400
  invalidAuth:
    type: template
    template: |
      { "error": "invalid auth token"}
    code: 401
  "404":
    type: template
    template: |
      { "status" : "failed", "message": "not found" }
    code: 404
  success:
    code: 200
    responseObject:
      fields:
        status:
          value: "success"
        data:
          value: "{{ .variable_actions_fetchItem }}"
